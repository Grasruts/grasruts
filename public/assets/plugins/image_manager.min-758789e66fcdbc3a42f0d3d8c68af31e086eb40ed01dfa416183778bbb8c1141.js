!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,a){return a===undefined&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(a)}:t(window.jQuery)}(function(O){if(O.extend(O.FE.DEFAULTS,{imageManagerLoadURL:"https://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:null,imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),O.FE.PLUGINS.imageManager=function(o){function r(){var e=O(window).outerWidth();return e<768?2:e<1200?3:4}function i(){L.empty();for(var e=0;e<E;e++)L.append('<div class="fr-list-column"></div>')}function g(){if(P<D.length&&(L.outerHeight()<=b.outerHeight()+o.opts.imageManagerScrollOffset||b.scrollTop()+o.opts.imageManagerScrollOffset>L.outerHeight()-b.outerHeight())){I++;for(var e=o.opts.imageManagerPageSize*(I-1);e<Math.min(D.length,o.opts.imageManagerPageSize*I);e++)a(D[e])}}function a(i){var n=new Image,s=O('<div class="fr-image-container fr-empty fr-image-'+x+++'" data-loading="'+o.language.translate("Loading")+'.." data-deleting="'+o.language.translate("Deleting")+'..">');f(!1),n.onload=function(){s.height(Math.floor(s.width()/n.width*n.height));var t=O("<img/>");if(i.thumb)t.attr("src",i.thumb);else{if(u(U,i),!i.url)return u(F,i),!1;t.attr("src",i.url)}if(i.url&&t.attr("data-url",i.url),i.tag)if(w.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),w.find(".fr-modal-tags").show(),0<=i.tag.indexOf(",")){for(var e=i.tag.split(","),a=0;a<e.length;a++)e[a]=e[a].trim(),0===y.find('a[title="'+e[a]+'"]').length&&y.append('<a role="button" title="'+e[a]+'">'+e[a]+"</a>");t.attr("data-tag",e.join())}else 0===y.find('a[title="'+i.tag.trim()+'"]').length&&y.append('<a role="button" title="'+i.tag.trim()+'">'+i.tag.trim()+"</a>"),t.attr("data-tag",i.tag.trim());for(var r in i.name&&t.attr("alt",i.name),i)i.hasOwnProperty(r)&&"thumb"!=r&&"url"!=r&&"tag"!=r&&t.attr("data-"+r,i[r]);s.append(t).append(O(o.icon.create("imageManagerDelete")).addClass("fr-delete-img").attr("title",o.language.translate("Delete"))).append(O(o.icon.create("imageManagerInsert")).addClass("fr-insert-img").attr("title",o.language.translate("Insert"))),y.find(".fr-selected-tag").each(function(e,a){v(t,a.text)||s.hide()}),t.on("load",function(){s.removeClass("fr-empty"),s.height("auto"),P++,d(l(parseInt(t.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1)),f(!1),P%o.opts.imageManagerPageSize==0&&g()}),o.events.trigger("imageManager.imageLoaded",[t])},n.onerror=function(){P++,s.remove(),d(l(parseInt(s.attr("class").match(/fr-image-(\d+)/)[1],10)+1)),u(e,i),P%o.opts.imageManagerPageSize==0&&g()},n.src=i.thumb||i.url,t().append(s)}function t(){var r,i;return L.find(".fr-list-column").each(function(e,a){var t=O(a);0===e?(i=t.outerHeight(),r=t):t.outerHeight()<i&&(i=t.outerHeight(),r=t)}),r}function l(e){e===undefined&&(e=0);for(var a=[],t=x-1;e<=t;t--){var r=L.find(".fr-image-"+t);r.length&&(a.push(r),O('<div id="fr-image-hidden-container">').append(r),L.find(".fr-image-"+t).remove())}return a}function d(e){for(var a=e.length-1;0<=a;a--)t().append(e[a])}function f(e){if(e===undefined&&(e=!0),!M.is(":visible"))return!0;var a=r();if(a!=E){E=a;var t=l();i(),d(t)}o.modals.resize(T),e&&g()}function m(e){var a={},t=e.data();for(var r in t)t.hasOwnProperty(r)&&"url"!=r&&"tag"!=r&&(a[r]=t[r]);return a}function n(e){var a=O(e.currentTarget).siblings("img"),t=M.data("instance")||o,r=M.data("current-image");if(o.modals.hide(T),t.image.showProgressBar(),r)r.data("fr-old-src",r.attr("src")),r.trigger("click");else{t.events.focus(!0),t.selection.restore();var i=t.position.getBoundingRect(),n=i.left+i.width/2+O(o.doc).scrollLeft(),s=i.top+i.height+O(o.doc).scrollTop();t.popups.setContainer("image.insert",o.$sc),t.popups.show("image.insert",n,s)}t.image.insert(a.data("url"),!1,m(a),r)}function s(e){var t=O(e.currentTarget).siblings("img"),a=o.language.translate("Are you sure? Image will be deleted.");confirm(a)&&(o.opts.imageManagerDeleteURL?!1!==o.events.trigger("imageManager.beforeDeleteImage",[t])&&(t.parent().addClass("fr-image-deleting"),O.ajax({method:o.opts.imageManagerDeleteMethod,url:o.opts.imageManagerDeleteURL,data:O.extend(O.extend({src:t.attr("src")},m(t)),o.opts.imageManagerDeleteParams),crossDomain:o.opts.requestWithCORS,xhrFields:{withCredentials:o.opts.requestWithCredentials},headers:o.opts.requestHeaders}).done(function(e){o.events.trigger("imageManager.imageDeleted",[e]);var a=l(parseInt(t.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);t.parent().remove(),d(a),M.find("#fr-modal-tags > a").each(function(){0===M.find('#fr-image-list [data-tag*="'+O(this).text()+'"]').length&&O(this).removeClass("fr-selected-tag").hide()}),h(),f(!0)}).fail(function(e){u(H,e.response||e.responseText)})):u(j))}function u(e,a){10<=e&&e<20?C.hide():20<=e&&e<30&&O(".fr-image-deleting").removeClass("fr-image-deleting"),o.events.trigger("imageManager.error",[{code:e,message:k[e]},a])}function c(){var e=w.find(".fr-modal-head-line").outerHeight(),a=y.outerHeight();w.toggleClass("fr-show-tags"),w.hasClass("fr-show-tags")?(w.css("height",e+a),y.find("a").css("opacity",1)):(w.css("height",e),y.find("a").css("opacity",0))}function h(){var e=y.find(".fr-selected-tag");0<e.length?(L.find("img").parent().show(),e.each(function(e,r){L.find("img").each(function(e,a){var t=O(a);v(t,r.text)||t.parent().hide()})})):L.find("img").parent().show(),d(l()),g()}function p(e){e.preventDefault();var a=O(e.currentTarget);a.toggleClass("fr-selected-tag"),o.opts.imageManagerToggleTags&&a.siblings("a").removeClass("fr-selected-tag"),h()}function v(e,a){for(var t=(e.attr("data-tag")||"").split(","),r=0;r<t.length;r++)if(t[r]==a)return!0;return!1}var M,w,b,C,L,y,D,I,P,x,E,T="image_manager",e=10,q=11,S=12,R=13,U=14,F=15,H=21,j=22,k={};return k[e]="Image cannot be loaded from the passed link.",k[q]="Error during load images request.",k[S]="Missing imageManagerLoadURL option.",k[R]="Parsing load response failed.",k[U]="Missing image thumb.",k[F]="Missing image URL.",k[H]="Error during delete image request.",k[j]="Missing imageManagerDeleteURL option.",{require:["image"],_init:function(){if(!o.$wp&&"IMG"!=o.el.tagName)return!1},show:function(){if(!M){var e,a='<div class="fr-modal-head-line"><i class="fa fa-bars fr-modal-more fr-not-available" id="fr-modal-more-'+o.sid+'" title="'+o.language.translate("Tags")+'"></i><h4 data-text="true">'+o.language.translate("Manage Images")+"</h4></div>";a+='<div class="fr-modal-tags" id="fr-modal-tags"></div>',e=o.opts.imageManagerPreloader?'<img class="fr-preloader" id="fr-preloader" alt="'+o.language.translate("Loading")+'.." src="'+o.opts.imageManagerPreloader+'" style="display: none;">':'<span class="fr-preloader" id="fr-preloader" style="display: none;">'+o.language.translate("Loading")+"</span>",e+='<div class="fr-image-list" id="fr-image-list"></div>';var t=o.modals.create(T,a,e);M=t.$modal,w=t.$head,b=t.$body}M.data("current-image",o.image.get()),o.modals.show(T),C||(C=M.find("#fr-preloader"),L=M.find("#fr-image-list"),y=M.find("#fr-modal-tags"),E=r(),i(),w.css("height",w.find(".fr-modal-head-line").outerHeight()),o.events.$on(O(o.o_win),"resize",function(){f(!!D)}),o.helpers.isMobile()&&(o.events.bindClick(L,"div.fr-image-container",function(e){M.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),O(e.currentTarget).addClass("fr-mobile-selected")}),M.on(o._mousedown,function(){M.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),o.events.bindClick(L,".fr-insert-img",n),o.events.bindClick(L,".fr-delete-img",s),M.on(o._mousedown+" "+o._mouseup,function(e){e.stopPropagation()}),M.on(o._mousedown,"*",function(){o.events.disableBlur()}),b.on("scroll",g),o.events.bindClick(M,"i#fr-modal-more-"+o.sid,c),o.events.bindClick(y,"a",p)),C.show(),L.find(".fr-list-column").empty(),o.opts.imageManagerLoadURL?O.ajax({url:o.opts.imageManagerLoadURL,method:o.opts.imageManagerLoadMethod,data:o.opts.imageManagerLoadParams,dataType:"json",crossDomain:o.opts.requestWithCORS,xhrFields:{withCredentials:o.opts.requestWithCredentials},headers:o.opts.requestHeaders}).done(function(e,a,t){o.events.trigger("imageManager.imagesLoaded",[e]),function(e,a){try{L.find(".fr-list-column").empty(),x=P=I=0,D=e,g()}catch(t){u(R,a)}}(e,t.response),C.hide()}).fail(function(){var e=this.xhr();u(q,e.response||e.responseText)}):u(S)},hide:function(){o.modals.hide(T)}}},!O.FE.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");O.FE.DEFAULTS.imageInsertButtons.push("imageManager"),O.FE.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,modal:!0,callback:function(){this.imageManager.show()},plugin:"imageManager"}),O.FE.DefineIcon("imageManager",{NAME:"folder"}),O.FE.DefineIcon("imageManagerInsert",{NAME:"plus"}),O.FE.DefineIcon("imageManagerDelete",{NAME:"trash"})});